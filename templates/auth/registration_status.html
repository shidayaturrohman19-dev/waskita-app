<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description"
              content="Status Registrasi - Waskita - Sistem Klasifikasi Konten Radikal menggunakan Machine Learning">
        <meta name="keywords"
              content="status registrasi, waskita, klasifikasi konten, machine learning">
        <title>Status Registrasi - Waskita</title>
        <!-- Google Font: Source Sans Pro -->
        <link rel="stylesheet"
              href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
        <!-- Font Awesome -->
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <!-- AdminLTE CSS -->
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
        <!-- SweetAlert2 CSS -->
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
        <style>
        .status-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .status-box {
            width: 500px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            color: white;
            border-radius: 15px 15px 0 0;
            text-align: center;
            padding: 2rem 1rem;
        }
        .status-pending .card-header {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
        }
        .status-approved .card-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        .status-rejected .card-header {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }
        .status-expired .card-header {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        .card-header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 300;
        }
        .card-body {
            padding: 2rem;
        }
        .status-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        .status-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
    }
    
    .status-subtitle {
        font-size: 16px;
        opacity: 0.9;
    }
    
    .status-body {
        padding: 30px;
    }
    
    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .info-row:last-child {
        border-bottom: none;
    }
    
    .info-label {
        font-weight: 600;
        color: #495057;
    }
    
    .info-value {
        color: #6c757d;
    }
    
    .timeline {
        position: relative;
        padding-left: 30px;
    }
    
    .timeline::before {
        content: '';
        position: absolute;
        left: 15px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #e9ecef;
    }
    
    .timeline-item {
        position: relative;
        margin-bottom: 20px;
        padding: 15px 20px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .timeline-item::before {
        content: '';
        position: absolute;
        left: -27px;
        top: 20px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #007bff;
        border: 3px solid white;
        box-shadow: 0 0 0 2px #007bff;
    }
    
    .timeline-item.success::before {
        background: #28a745;
        box-shadow: 0 0 0 2px #28a745;
    }
    
    .timeline-item.danger::before {
        background: #dc3545;
        box-shadow: 0 0 0 2px #dc3545;
    }
    
    .timeline-item.warning::before {
        background: #ffc107;
        box-shadow: 0 0 0 2px #ffc107;
    }
    
    .timeline-time {
        font-size: 12px;
        color: #6c757d;
        margin-bottom: 5px;
    }
    
    .timeline-title {
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .timeline-desc {
        font-size: 14px;
        color: #6c757d;
    }
    
    .action-buttons {
        text-align: center;
        margin-top: 30px;
    }
    
        .btn-refresh {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
            color: white;
        }
        
        .alert-info {
            border-left: 4px solid #17a2b8;
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f9ff 100%);
            border: 1px solid #bee5eb;
            border-radius: 10px;
            color: #0c5460;
            box-shadow: 0 2px 10px rgba(23, 162, 184, 0.1);
        }
        
        .alert-info strong {
            color: #0c5460;
            font-weight: 600;
        }
        </style>
    </head>
    <body class="hold-transition status-page">
        <div class="status-page d-flex justify-content-center align-items-center">
            <div class="status-box">
                <div class="card status-{{ request.status }}">
                    <!-- Status Header -->
                    <div class="card-header">
                        <div class="status-icon">
                            {% if request.status == 'pending' %}
                                <i class="fas fa-clock"></i>
                            {% elif request.status == 'approved' %}
                                <i class="fas fa-check-circle"></i>
                            {% elif request.status == 'rejected' %}
                                <i class="fas fa-times-circle"></i>
                            {% elif request.status == 'expired' %}
                                <i class="fas fa-hourglass-end"></i>
                            {% endif %}
                        </div>
                        
                        <h1>
                            {% if request.status == 'pending' %}
                                Menunggu Persetujuan
                            {% elif request.status == 'approved' %}
                                Registrasi Disetujui
                            {% elif request.status == 'rejected' %}
                                Registrasi Ditolak
                            {% elif request.status == 'expired' %}
                                Permintaan Expired
                            {% endif %}
                        </h1>
                        
                        <p class="mb-0">
                            {% if request.status == 'pending' %}
                                Permintaan registrasi Anda sedang ditinjau oleh administrator
                            {% elif request.status == 'approved' %}
                                Selamat! Akun Anda telah disetujui dan dapat digunakan
                            {% elif request.status == 'rejected' %}
                                Maaf, permintaan registrasi Anda tidak dapat disetujui
                            {% elif request.status == 'expired' %}
                                Permintaan registrasi Anda telah melewati batas waktu
                            {% endif %}
                        </p>
                    </div>
                    
                    <!-- Status Body -->
                    <div class="card-body">
                        <!-- Request Information -->
                        <h5 class="mb-3">
                            <i class="fas fa-info-circle text-primary mr-2"></i>
                            Informasi Permintaan
                        </h5>
                        
                        <div class="info-row">
                            <span class="info-label">Username:</span>
                            <span class="info-value">{{ request.username }}</span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Email:</span>
                            <span class="info-value">{{ request.email }}</span>
                        </div>
                        
                        {% if request.full_name %}
                        <div class="info-row">
                            <span class="info-label">Nama Lengkap:</span>
                            <span class="info-value">{{ request.full_name }}</span>
                        </div>
                        {% endif %}
                        
                        <div class="info-row">
                            <span class="info-label">Tanggal Permintaan:</span>
                            <span class="info-value">{{ request.created_at.strftime('%d/%m/%Y %H:%M WIB') }}</span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value">
                                <span class="badge badge-{{ 'warning' if request.status == 'pending' else 'success' if request.status == 'approved' else 'danger' if request.status == 'rejected' else 'secondary' }}">
                                    {% if request.status == 'pending' %}
                                        Menunggu Persetujuan
                                    {% elif request.status == 'approved' %}
                                        Disetujui
                                    {% elif request.status == 'rejected' %}
                                        Ditolak
                                    {% elif request.status == 'expired' %}
                                        Expired
                                    {% endif %}
                                </span>
                            </span>
                        </div>
                        
                        {% if request.approved_at %}
                        <div class="info-row">
                            <span class="info-label">Tanggal Diproses:</span>
                            <span class="info-value">{{ request.approved_at.strftime('%d/%m/%Y %H:%M WIB') }}</span>
                        </div>
                        {% endif %}
                        
                        {% if request.admin_notes %}
                        <div class="info-row">
                            <span class="info-label">Catatan Admin:</span>
                            <span class="info-value">{{ request.admin_notes }}</span>
                        </div>
                        {% endif %}
                        
                        <!-- Status Messages -->
                        {% if request.status == 'pending' %}
                            <div class="alert alert-info mt-4">
                                <i class="fas fa-info-circle mr-2"></i>
                                <strong>Informasi:</strong> Administrator telah menerima permintaan registrasi Anda dan akan segera meninjau. 
                                Anda akan menerima email konfirmasi setelah permintaan diproses.
                                
                                {% if request.otp_expires_at %}
                                    <br><br>
                                    <strong>Batas waktu:</strong> {{ request.otp_expires_at.strftime('%d/%m/%Y %H:%M WIB') }}
                                {% endif %}
                            </div>
                        {% elif request.status == 'approved' %}
                            <div class="alert alert-success mt-4">
                                <i class="fas fa-check-circle mr-2"></i>
                                <strong>Selamat!</strong> Registrasi Anda telah disetujui. Anda sekarang dapat login menggunakan username dan password yang telah dibuat.
                            </div>
                        {% elif request.status == 'rejected' %}
                            <div class="alert alert-danger mt-4">
                                <i class="fas fa-times-circle mr-2"></i>
                                <strong>Maaf,</strong> permintaan registrasi Anda tidak dapat disetujui. 
                                {% if request.admin_notes %}
                                    Alasan: {{ request.admin_notes }}
                                {% endif %}
                                Anda dapat mengajukan permintaan baru jika diperlukan.
                            </div>
                        {% elif request.status == 'expired' %}
                            <div class="alert alert-warning mt-4">
                                <i class="fas fa-hourglass-end mr-2"></i>
                                <strong>Expired:</strong> Permintaan registrasi Anda telah melewati batas waktu. 
                                Silakan ajukan permintaan registrasi baru.
                            </div>
                        {% endif %}
                        
                        <!-- Email Timeline - Hidden for security -->
                        {% if false and email_logs %}
                        <h5 class="mb-3 mt-4">
                            <i class="fas fa-envelope text-primary mr-2"></i>
                            Riwayat Email
                        </h5>
                        
                        <div class="timeline">
                            {% for log in email_logs %}
                            <div class="timeline-item {{ 'success' if log.is_sent else 'danger' }}">
                                <div class="timeline-time">
                                    {{ log.created_at.strftime('%d/%m/%Y %H:%M WIB') }}
                                </div>
                                <div class="timeline-title">
                                    {% if log.email_type == 'otp_notification' %}
                                        Notifikasi OTP ke Admin
                                    {% elif log.email_type == 'approval_notification' %}
                                        Notifikasi Persetujuan
                                    {% else %}
                                        {{ log.email_type.replace('_', ' ').title() }}
                                    {% endif %}
                                </div>
                                <div class="timeline-desc">
                                    <strong>Penerima:</strong> {{ log.recipient_email }}<br>
                                    <strong>Status:</strong> 
                                    {% if log.is_sent %}
                                        <span class="text-success">Berhasil dikirim</span>
                                    {% else %}
                                        <span class="text-danger">Gagal dikirim</span>
                                        {% if log.error_message %}
                                            - {{ log.error_message }}
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <a href="{{ url_for('otp.registration_status', request_id=request.id) }}" class="btn btn-refresh">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Refresh Status
                            </a>
                            
                            {% if request.status == 'approved' %}
                                <a href="{{ url_for('login') }}" class="btn btn-success ml-2">
                                    <i class="fas fa-sign-in-alt mr-2"></i>
                                    Login Sekarang
                                </a>
                            {% elif request.status in ['rejected', 'expired'] %}
                                <a href="{{ url_for('otp.register_request') }}" class="btn btn-primary ml-2">
                                    <i class="fas fa-user-plus mr-2"></i>
                                    Daftar Ulang
                                </a>
                            {% endif %}
                            
                            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary ml-2">
                                <i class="fas fa-home mr-2"></i>
                                Kembali ke Beranda
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <!-- Bootstrap 4 -->
        <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
        <!-- SweetAlert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
        
        <script>
        $(document).ready(function() {
            // Auto refresh every 30 seconds for pending requests
            {% if request.status == 'pending' %}
            setInterval(function() {
                // Check if page is visible
                if (!document.hidden) {
                    location.reload();
                }
            }, 30000); // 30 seconds
            {% endif %}
            
            // Show notification if status changed
            {% if request.status == 'approved' %}
                // Show success notification
                if (typeof Swal !== 'undefined') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Registrasi Disetujui!',
                        text: 'Selamat! Akun Anda telah disetujui dan dapat digunakan.',
                        confirmButtonText: 'Login Sekarang',
                        showCancelButton: true,
                        cancelButtonText: 'Nanti'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = "{{ url_for('login') }}";
                        }
                    });
                }
            {% elif request.status == 'rejected' %}
                if (typeof Swal !== 'undefined') {
                    Swal.fire({
                        icon: 'error',
                        title: 'Registrasi Ditolak',
                        text: 'Maaf, permintaan registrasi Anda tidak dapat disetujui.',
                        confirmButtonText: 'OK'
                    });
                }
            {% endif %}
        });
        </script>
    </body>
</html>