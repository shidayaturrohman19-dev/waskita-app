{% extends "base.html" %}
{% block title %}Profil Pengguna - Waskita{% endblock title %}
{% block page_title %}
    Profil Pengguna
{% endblock page_title %}
{% block breadcrumb %}
    <li class="breadcrumb-item">
        <a href="{{ url_for("dashboard") }}">Home</a>
    </li>
    <li class="breadcrumb-item active">Profil</li>
{% endblock breadcrumb %}
{% block content %}
        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <!-- Profile Information -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body box-profile">
                                <div class="text-center">
                                    <i class="fas fa-user-circle fa-5x text-secondary mb-3"></i>
                                    <h3 class="profile-username text-center">{{ current_user.username }}</h3>
                                    <p class="text-muted text-center">
                                        {% if current_user.is_admin %}
                                            <span class="badge bg-secondary"><i class="fas fa-crown mr-1"></i>Administrator</span>
                                        {% else %}
                                            <span class="badge bg-secondary"><i class="fas fa-user mr-1"></i>User</span>
                                        {% endif %}
                                    </p>
                                </div>
                                <ul class="list-group list-group-unbordered mb-3">
                                    <li class="list-group-item">
                                        <b>Total Upload</b> <a class="float-right">{{ user_stats.total_uploads or 0 }}</a>
                                    </li>
                                    <li class="list-group-item">
                                        <b>Data Diproses</b> <a class="float-right">{{ user_stats.total_processed or 0 }}</a>
                                    </li>
                                    <li class="list-group-item">
                                        <b>Klasifikasi</b> <a class="float-right">{{ user_stats.total_classifications or 0 }}</a>
                                    </li>
                                    <li class="list-group-item">
                                        <b>Bergabung</b> <a class="float-right">{{ current_user.created_at|format_datetime('date') }}</a>
                                    </li>
                                    <li class="list-group-item">
                                        <b>Terakhir Login</b>
                                        <a class="float-right">
                                            {% if current_user.last_login %}
                                                {{ current_user.last_login|format_datetime('date') }}
                                            {% else %}
                                                Belum pernah
                                            {% endif %}
                                        </a>
                                    </li>
                                </ul>
                                <button class="btn btn-secondary btn-block" onclick="showEditProfileModal()">
                                    <i class="fas fa-edit mr-2"></i>Edit Profil
                                </button>
                            </div>
                        </div>
                        <!-- Account Security -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-shield-alt mr-2"></i>Keamanan Akun
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label>Status Akun:</label>
                                    <div>
                                        <span class="badge badge-{{ 'success' if current_user.is_active else 'danger' }} badge-lg">
                                            {{ 'Aktif' if current_user.is_active else 'Nonaktif' }}
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Keamanan Password:</label>
                                    <div class="password-security-indicator">
                                        <div class="security-level">
                                            <span>Status Keamanan</span>
                                            <span class="security-level-badge security-strong" id="securityBadge">
                                                <i class="fas fa-shield-alt"></i>
                                                Kuat
                                            </span>
                                        </div>
                                        
                                        <div class="security-progress">
                                            <div class="security-progress-bar security-progress-strong" id="securityProgressBar"></div>
                                        </div>
                                        

                                        
                                        <div class="password-last-changed">
                                            <span>
                                                <i class="fas fa-clock mr-1"></i>
                                                Terakhir diubah: 
                                                <span id="lastPasswordChange">{{ current_user.password_changed_at|format_datetime('date') if current_user.password_changed_at else 'Belum pernah' }}</span>
                                            </span>
                                            <span class="password-age-warning" id="passwordAgeWarning" style="display: none;">
                                                <i class="fas fa-exclamation-triangle"></i>
                                                Perlu diperbarui
                                            </span>
                                        </div>
                                        
                                        <div class="security-recommendations" id="securityRecommendations" style="display: none;">
                                            <h6><i class="fas fa-lightbulb mr-1"></i>Rekomendasi Keamanan</h6>
                                            <ul id="recommendationsList">
                                                <li>Gunakan kombinasi huruf besar dan kecil</li>
                                                <li>Tambahkan karakter khusus (!@#$%^&*)</li>
                                                <li>Perbanyak panjang password (minimal 12 karakter)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary btn-block" onclick="showChangePasswordModal()">
                                    <i class="fas fa-key mr-2"></i>Ubah Password
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Activity and Settings -->
                    <div class="col-md-8">
                        <!-- Activity Statistics -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-chart-line mr-2"></i>Statistik Aktivitas
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 col-sm-6 col-12">
                                        <div class="info-box">
                                            <span class="info-box-icon bg-info elevation-1"><i class="fas fa-upload"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Upload Manual</span>
                                                <span class="info-box-number">{{ user_stats.manual_uploads or 0 }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6 col-12">
                                        <div class="info-box">
                                            <span class="info-box-icon bg-success elevation-1"><i class="fas fa-robot"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Scraping</span>
                                                <span class="info-box-number">{{ user_stats.scraping_count or 0 }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6 col-12">
                                        <div class="info-box">
                                            <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-broom"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Data Cleaned</span>
                                                <span class="info-box-number">{{ user_stats.cleaned_data or 0 }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6 col-12">
                                        <div class="info-box">
                                            <span class="info-box-icon bg-danger elevation-1"><i class="fas fa-brain"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Klasifikasi</span>
                                                <span class="info-box-number">{{ user_stats.total_classifications or 0 }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Activity Chart -->
                                <div class="chart">
                                    <canvas id="activityChart" class="activity-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- Recent Activity -->
                        <div class="card">
                            <header class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-clock mr-1" aria-hidden="true"></i>
                                    Aktivitas Terbaru
                                </h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="refreshActivity()">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </header>
                            <main class="card-body p-3 d-flex flex-column">
                                <div class="activity-list flex-grow-1" role="log" aria-label="Timeline aktivitas terbaru" aria-live="polite">
                                    {% if recent_activities %}
                                        {% for activity in recent_activities %}
                                            <div class="activity-item d-flex align-items-start mb-3 {% if loop.last %}mb-2{% endif %}">
                                                <div class="activity-icon mr-3">
                                                    <i class="fas fa-{{ activity.icon }} text-{{ activity.type_color }}" aria-hidden="true"></i>
                                                </div>
                                                <div class="activity-content flex-grow-1">
                                                    <div class="d-flex justify-content-between align-items-start">
                                                        <h6 class="activity-title mb-1 font-weight-bold">{{ activity.title }}</h6>
                                                        <small class="text-muted ml-2">{{ activity.time }}</small>
                                                    </div>
                                                    <p class="activity-description mb-1 text-muted small">
                                                        {% if activity.description|length > 60 %}
                                                            {{ activity.description[:60] }}...
                                                        {% else %}
                                                            {{ activity.description }}
                                                        {% endif %}
                                                    </p>
                                                    <small class="activity-date text-primary">{{ activity.date }}</small>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="text-center text-muted py-3 d-flex flex-column justify-content-center h-100" role="status" aria-label="Tidak ada aktivitas terbaru">
                                            <i class="fas fa-info-circle fa-lg mb-2" aria-hidden="true"></i>
                                            <p class="mb-0 small">Belum ada aktivitas terbaru</p>
                                        </div>
                                    {% endif %}
                                </div>
                            </main>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit mr-2"></i>Edit Profil
                    </h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editProfileForm">
                        <div class="form-group">
                            <label for="editUsername">Username:</label>
                            <input type="text"
                                   class="form-control"
                                   id="editUsername"
                                   value="{{ current_user.username }}"
                                   readonly>
                            <small class="form-text text-muted">Username tidak dapat diubah</small>
                        </div>
                        <div class="form-group">
                            <label for="editEmail">Email:</label>
                            <input type="email"
                                   class="form-control"
                                   id="editEmail"
                                   value="{{ current_user.email }}"
                                   required>
                        </div>
                        <div class="form-group">
                            <label for="editFullName">Nama Lengkap:</label>
                            <input type="text"
                                   class="form-control"
                                   id="editFullName"
                                   value="{{ current_user.full_name or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="editBio">Bio:</label>
                            <textarea class="form-control"
                                      id="editBio"
                                      rows="3"
                                      placeholder="Ceritakan tentang diri Anda...">{{ current_user.bio or '' }}</textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="saveProfile()">Simpan Perubahan</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Change Password Modal -->
    <div class="modal fade"
         id="changePasswordModal"
         tabindex="-1"
         role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-key mr-2"></i>Ubah Password
                    </h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">Password Saat Ini:</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Password Baru:</label>
                            <input type="password" class="form-control" id="newPassword" required>
                            <div class="password-strength mt-2">
                                <div class="progress progress-sm">
                                    <div class="progress-bar" id="passwordStrength"></div>
                                </div>
                                <small class="text-muted" id="passwordStrengthText">Masukkan password baru</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmNewPassword">Konfirmasi Password Baru:</label>
                            <input type="password" class="form-control" id="confirmNewPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-warning" onclick="changePassword()">Ubah Password</button>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block scripts %}
    <script>
$(document).ready(function() {
    // Initialize activity chart
    initializeActivityChart();
    
    // Password strength checker
    $('#newPassword').on('input', function() {
        checkPasswordStrength($(this).val());
    });
});

function initializeActivityChart() {
    // Pastikan Chart.js sudah dimuat
    if (typeof Chart === 'undefined') {
        return;
    }
    
    const ctx = document.getElementById('activityChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul'],
            datasets: [
                {
                    label: 'Upload',
                    data: [12, 19, 3, 5, 2, 3, 8],
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Klasifikasi',
                    data: [8, 15, 12, 18, 10, 14, 20],
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Cleaning',
                    data: [5, 8, 6, 10, 7, 9, 12],
                    borderColor: '#ffc107',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function showEditProfileModal() {
    $('#editProfileModal').modal('show');
}

function saveProfile() {
    const email = $('#editEmail').val();
    const fullName = $('#editFullName').val();
    const bio = $('#editBio').val();
    
    if (!email) {
        Swal.fire({
            icon: 'error',
            title: 'Email Diperlukan',
            text: 'Email tidak boleh kosong'
        });
        return;
    }
    
    // Show loading
    Swal.fire({
        title: 'Menyimpan Profil',
        text: 'Sedang memproses...',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
    
    // Send AJAX request to backend
    $.ajax({
        url: '/api/profile/edit',
        method: 'POST',
        headers: {
            'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()
        },
        data: {
            email: email,
            full_name: fullName,
            bio: bio
        },
        success: function(response) {
            $('#editProfileModal').modal('hide');
            Swal.fire({
                icon: 'success',
                title: 'Profil Berhasil Diperbarui',
                text: response.message
            }).then(() => {
                location.reload();
            });
        },
        error: function(xhr) {
            let errorMessage = 'Terjadi kesalahan saat menyimpan profil';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMessage = xhr.responseJSON.message;
            }
            Swal.fire({
                icon: 'error',
                title: 'Gagal Menyimpan Profil',
                text: errorMessage
            });
        }
    });
}

function showChangePasswordModal() {
    $('#changePasswordModal').modal('show');
}

function changePassword() {
    const currentPassword = $('#currentPassword').val();
    const newPassword = $('#newPassword').val();
    const confirmNewPassword = $('#confirmNewPassword').val();
    
    if (!currentPassword || !newPassword || !confirmNewPassword) {
        Swal.fire({
            icon: 'error',
            title: 'Field Tidak Lengkap',
            text: 'Semua field password harus diisi'
        });
        return;
    }
    
    if (newPassword !== confirmNewPassword) {
        Swal.fire({
            icon: 'error',
            title: 'Password Tidak Cocok',
            text: 'Password baru dan konfirmasi password tidak cocok'
        });
        return;
    }
    
    if (newPassword.length < 6) {
        Swal.fire({
            icon: 'error',
            title: 'Password Terlalu Pendek',
            text: 'Password baru minimal 6 karakter'
        });
        return;
    }
    
    // Show loading
    Swal.fire({
        title: 'Mengubah Password',
        text: 'Sedang memproses...',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
    
    // Send AJAX request to backend
    $.ajax({
        url: '/api/profile/change-password',
        method: 'POST',
        headers: {
            'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()
        },
        data: {
            current_password: currentPassword,
            new_password: newPassword
        },
        success: function(response) {
            $('#changePasswordModal').modal('hide');
            $('#changePasswordForm')[0].reset();
            Swal.fire({
                icon: 'success',
                title: 'Password Berhasil Diubah',
                text: response.message
            });
        },
        error: function(xhr) {
            let errorMessage = 'Terjadi kesalahan saat mengubah password';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMessage = xhr.responseJSON.message;
            }
            Swal.fire({
                icon: 'error',
                title: 'Gagal Mengubah Password',
                text: errorMessage
            });
        }
    });
}

function checkPasswordStrength(password) {
    const strengthBar = $('#passwordStrength');
    const strengthText = $('#passwordStrengthText');
    
    let strength = 0;
    let strengthLabel = '';
    let strengthClass = '';
    
    if (password.length >= 6) strength += 1;
    if (password.match(/[a-z]/)) strength += 1;
    if (password.match(/[A-Z]/)) strength += 1;
    if (password.match(/[0-9]/)) strength += 1;
    if (password.match(/[^a-zA-Z0-9]/)) strength += 1;
    
    switch (strength) {
        case 0:
        case 1:
            strengthLabel = 'Sangat Lemah';
            strengthClass = 'bg-danger';
            break;
        case 2:
            strengthLabel = 'Lemah';
            strengthClass = 'bg-warning';
            break;
        case 3:
            strengthLabel = 'Sedang';
            strengthClass = 'bg-info';
            break;
        case 4:
            strengthLabel = 'Kuat';
            strengthClass = 'bg-success';
            break;
        case 5:
            strengthLabel = 'Sangat Kuat';
            strengthClass = 'bg-success';
            break;
    }
    
    const percentage = (strength / 5) * 100;
    strengthBar.removeClass('bg-danger bg-warning bg-info bg-success')
               .addClass(strengthClass)
               .css('width', percentage + '%');
    strengthText.text(strengthLabel);
}

function refreshActivity() {
    // Show loading state
    const refreshBtn = $('.card-tools button');
    const originalIcon = refreshBtn.find('i');
    originalIcon.removeClass('fa-sync-alt').addClass('fa-spinner fa-spin');
    
    // Simulate refresh (replace with actual AJAX call)
    setTimeout(() => {
        originalIcon.removeClass('fa-spinner fa-spin').addClass('fa-sync-alt');
        
        Swal.fire({
            icon: 'success',
            title: 'Aktivitas Diperbarui',
            text: 'Data aktivitas terbaru telah dimuat',
            timer: 2000,
            showConfirmButton: false
        });
    }, 1500);
}

// Save preferences function (if needed for future use)
function savePreferences() {
    const preferences = {
        language: $('#language').val(),
        timezone: $('#timezone').val(),
        items_per_page: $('#itemsPerPage').val(),
        default_dataset: $('#defaultDataset').val(),
        email_notifications: $('#emailNotifications').is(':checked'),
        auto_refresh: $('#autoRefresh').is(':checked'),
        dark_mode: $('#darkMode').is(':checked'),
        auto_classify: $('#autoClassify').is(':checked'),
        show_probability: $('#showProbability').is(':checked'),
        compact_view: $('#compactView').is(':checked')
    };
    
    // Show loading
    Swal.fire({
        title: 'Menyimpan Preferensi',
        text: 'Sedang memproses...',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
    
    // Send AJAX request to backend
    $.ajax({
        url: '/api/profile/save-preferences',
        method: 'POST',
        headers: {
            'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()
        },
        data: preferences,
        success: function(response) {
            Swal.fire({
                icon: 'success',
                title: 'Preferensi Tersimpan',
                text: response.message
            });
        },
        error: function(xhr) {
            let errorMessage = 'Terjadi kesalahan saat menyimpan preferensi';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMessage = xhr.responseJSON.message;
            }
            Swal.fire({
                icon: 'error',
                title: 'Gagal Menyimpan Preferensi',
                text: errorMessage
            });
        }
    });
}

// Reset preferences function (if needed for future use)
function resetPreferences() {
    Swal.fire({
        title: 'Reset Preferensi?',
        text: 'Semua preferensi akan dikembalikan ke pengaturan default',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Ya, Reset',
        cancelButtonText: 'Batal'
    }).then((result) => {
        if (result.isConfirmed) {
            // Reset form values to default
            $('#language').val('id');
            $('#timezone').val('Asia/Jakarta');
            $('#itemsPerPage').val('25');
            $('#defaultDataset').val('');
            $('#emailNotifications').prop('checked', true);
            $('#autoRefresh').prop('checked', false);
            $('#darkMode').prop('checked', true);
            $('#autoClassify').prop('checked', false);
            $('#showProbability').prop('checked', true);
            $('#compactView').prop('checked', false);
            
            Swal.fire({
                icon: 'success',
                title: 'Preferensi Direset',
                text: 'Semua preferensi telah dikembalikan ke default'
            });
        }
    });
}
    </script>
    <style>
.badge-lg {
    font-size: 0.9em;
    padding: 0.5em 0.75em;
}

.timeline-inverse .timeline-item {
    background: #fff;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.info-box {
    transition: transform 0.2s;
}

.info-box:hover {
    transform: translateY(-2px);
}

.password-strength .progress {
    height: 4px;
}

.modal-header {
    border-bottom: 1px solid #dee2e6;
}

.modal-footer {
    border-top: 1px solid #dee2e6;
}

.card-header {
    border-bottom: 1px solid rgba(0,0,0,.125);
}

.list-group-item {
    border: 1px solid rgba(0,0,0,.125);
}

.timeline {
    position: relative;
    margin: 0 0 30px 0;
    padding: 0;
    list-style: none;
}

.timeline:before {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    width: 4px;
    background: #dee2e6;
    left: 31px;
    margin: 0;
    border-radius: 2px;
}
    </style>

.w-85 {
    width: 85% !important;
}

.activity-chart {
    min-height: 250px;
    height: 250px;
    max-height: 250px;
    max-width: 100%;
}

.progress-sm {
    height: 5px;
}
{% endblock scripts %}

<script>
// Password Security Indicator Functions
function evaluatePasswordSecurity() {
    // Simulasi evaluasi keamanan password
    // Dalam implementasi nyata, ini akan menganalisis password yang sebenarnya
    const features = {
        length: true,
        uppercase: true,
        lowercase: true,
        numbers: true,
        special: false
    };
    
    const score = Object.values(features).filter(Boolean).length;
    updateSecurityIndicator(score, features);
    checkPasswordAge();
}

function updateSecurityIndicator(score, features) {
    const badge = document.getElementById('securityBadge');
    const progressBar = document.getElementById('securityProgressBar');
    const recommendations = document.getElementById('securityRecommendations');
    
    // Update badge and progress bar based on score
    badge.className = 'security-level-badge';
    progressBar.className = 'security-progress-bar';
    
    if (score >= 4) {
        badge.classList.add('security-strong');
        progressBar.classList.add('security-progress-strong');
        badge.innerHTML = '<i class="fas fa-shield-alt"></i> Kuat';
        recommendations.style.display = 'none';
    } else if (score >= 3) {
        badge.classList.add('security-good');
        progressBar.classList.add('security-progress-good');
        badge.innerHTML = '<i class="fas fa-shield-check"></i> Baik';
        recommendations.style.display = 'block';
    } else if (score >= 2) {
        badge.classList.add('security-medium');
        progressBar.classList.add('security-progress-medium');
        badge.innerHTML = '<i class="fas fa-shield-virus"></i> Sedang';
        recommendations.style.display = 'block';
    } else {
        badge.classList.add('security-weak');
        progressBar.classList.add('security-progress-weak');
        badge.innerHTML = '<i class="fas fa-shield-virus"></i> Lemah';
        recommendations.style.display = 'block';
    }
}

function checkPasswordAge() {
    const lastChanged = document.getElementById('lastPasswordChange').textContent;
    const warning = document.getElementById('passwordAgeWarning');
    
    // Simulasi pengecekan umur password
    // Dalam implementasi nyata, ini akan menghitung dari tanggal terakhir diubah
    if (lastChanged === 'Belum pernah' || isPasswordOld(lastChanged)) {
        warning.style.display = 'inline-block';
    } else {
        warning.style.display = 'none';
    }
}

function isPasswordOld(dateString) {
    // Simulasi pengecekan apakah password sudah lama (>90 hari)
    // Dalam implementasi nyata, ini akan menghitung selisih tanggal
    return false; // Untuk demo, anggap password masih baru
}

// Initialize security indicator when page loads
document.addEventListener('DOMContentLoaded', function() {
    evaluatePasswordSecurity();
});

// Update security indicator when password is changed
function onPasswordChanged() {
    setTimeout(() => {
        evaluatePasswordSecurity();
        document.getElementById('lastPasswordChange').textContent = new Date().toLocaleDateString('id-ID');
    }, 500);
}
</script>
